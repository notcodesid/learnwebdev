{"version":3,"sources":["../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["LRUCache","path","NEXT_CACHE_TAGS_HEADER","NEXT_DATA_SUFFIX","NEXT_META_SUFFIX","RSC_PREFETCH_SUFFIX","RSC_SUFFIX","memoryCache","tagsManifest","FileSystemCache","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","pagesDir","_pagesDir","revalidatedTags","experimental","debug","process","env","NEXT_PRIVATE_DEBUG_CACHE","maxMemoryCacheSize","console","log","max","length","value","JSON","kind","stringify","props","Error","data","body","html","pageData","tagsManifestPath","join","loadTagsManifest","resetRequestCache","parse","readFileSync","err","version","items","revalidateTag","args","tags","tag","revalidatedAt","Date","now","mkdir","dirname","writeFile","warn","get","key","softTags","kindHint","NEXT_RUNTIME","filePath","getFilePath","fileData","readFile","mtime","stat","meta","replace","cacheEntry","lastModified","getTime","headers","status","_","detectFileKind","isAppPath","parsedData","storedTags","every","includes","set","ppr","postponed","cacheTags","tagsHeader","split","isStale","some","undefined","combinedTags","wasRevalidated","htmlPath","pathname","existsSync"],"mappings":"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"}